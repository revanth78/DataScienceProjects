# -*- coding: utf-8 -*-
"""taxi_trip_fare_prediction.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1jjOKIIW_YQ7ek3qkomZE4wPxe8hzx4cM
"""

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

df = pd.read_csv("train.csv")
df.head(5)

df.info()

df.describe()

df.drop(['store_and_fwd_flag','rate_code', 'payment_type', 'year', 'imp_surcharge', 'calculated_total_amount', 'total_amount', 'extra','mta_tax','tip_amount','tolls_amount'], inplace=True, axis="columns")

df.head(5)

df.shape

df1 = df[(df["trip_distance"] > 0) | (df["fare_amount"] > 0) | (df["trip_duration"]> 0) ]

df1.shape

X_train = df1.drop(['fare_amount'], axis= "columns")
X_train.head()

y_train = df1["fare_amount"]
y_train.head()

from sklearn.ensemble import RandomForestRegressor
model = RandomForestRegressor(n_estimators=10, random_state=0, oob_score=True)
model.fit(X_train,y_train)

from sklearn.metrics import mean_squared_error, r2_score
oob_score = model.oob_score_
print(oob_score)

test = pd.read_csv("test.csv")
test.head(5)

test.drop(['rate_code', 'payment_type', 'year', 'imp_surcharge' ,'store_and_fwd_flag','extra','mta_tax', 'tip_amount','total_amount', 'tolls_amount'], inplace=True, axis="columns")

X_test = test.drop(['fare_amount'], axis="columns")
X_test.head(5)

y_test = test['fare_amount']
y_test.head()

y_pred = model.predict(X_test)

mse = mean_squared_error(y_test, y_pred)
print(f'Mean Squared Error: {mse}')

r2 = r2_score(y_test, y_pred)
print(f'R-squared: {r2}')

import pickle
with open('model.pkl', 'wb') as f:
    pickle.dump(model, f)